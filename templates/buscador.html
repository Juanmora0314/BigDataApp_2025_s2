{% extends "base.html" %}

{% block title %}Buscador de normatividad ¬∑ MinMinas Big Data{% endblock %}

{% block content %}
<main class="container py-5">

  <h1 class="display-6 fw-semibold mb-2">Buscador de normatividad</h1>
  <p class="text-muted mb-4">
    Escribe palabras clave relacionadas con la norma que deseas consultar.
  </p>

  <!-- Formulario de b√∫squeda -->
  <form method="get" action="{{ url_for('buscador') }}" class="row g-2 mb-4">
    <div class="col-sm-9 col-md-10">
      <input type="search"
             name="q"
             value="{{ query or '' }}"
             class="form-control form-control-lg"
             placeholder="Ej. 'resoluci√≥n tarifas', 'ley 1715', 'hidrocarburos'">
    </div>
    <div class="col-sm-3 col-md-2 d-grid">
      <button type="submit" class="btn btn-primary btn-lg">
        üîé Buscar
      </button>
    </div>
  </form>

  {% if query %}
    <!-- Resumen de resultados -->
    <div class="d-flex align-items-center gap-3 mb-3 flex-wrap">
      <span class="small text-muted">
        Resultados para: <strong>"{{ query }}"</strong>
      </span>

      {% if total and total > 0 %}
        <span class="badge bg-secondary">
          {{ total }} documento(s) encontrado(s)
        </span>
      {% else %}
        <span class="text-danger small">No se encontraron documentos.</span>
      {% endif %}
    </div>

    <!-- Lista de resultados -->
    <section class="resultados-lista">
      {% for doc in resultados %}
        {# Si viene de Elasticsearch: doc['_source'].
           Si ya viene ‚Äúplano‚Äù, usamos el propio doc. #}
        {% set src = doc.get('_source', doc) %}
        {% set score = doc.get('_score', doc.get('score', 0)) %}

        <article class="resultado-item border rounded-3 p-3 mb-3 bg-white shadow-sm-sm">
          <div class="d-flex justify-content-between align-items-start gap-3">
            <div>
              <h2 class="h5 mb-1">
                {{ src.get('titulo', src.get('titulo_norma', 'Sin t√≠tulo')) }}
              </h2>
              <p class="small text-muted mb-0">
                <strong>Entidad:</strong>
                {{ src.get('entidad', src.get('entidad_emisora', 'N/D')) }}
                &nbsp;¬∑&nbsp;
                <strong>A√±o:</strong>
                {{ src.get('anio', src.get('anio_norma', 'N/D')) }}
                &nbsp;¬∑&nbsp;
                <strong>Tipo:</strong>
                {{ src.get('tipo', src.get('tipo_norma', 'N/D')) }}
              </p>
            </div>

            <span class="badge rounded-pill bg-light text-muted border">
              score: {{ '%.2f'|format(score) }}
            </span>
          </div>
        </article>
      {% endfor %}
    </section>
  {% endif %}

</main>
{% endblock %}
