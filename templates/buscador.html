{% extends "base.html" %}

{% block title %}Buscador 路 MinMinas BigData{% endblock %}

{% block content %}
<main class="container my-5">
  <section class="row">
    <div class="col-lg-6">
      <h1 class="display-6 fw-bold mb-3">
        Normatividad minera y energ茅tica, buscada como en 2025.
      </h1>
      <p>
        Escribe palabras clave relacionadas con la norma que deseas consultar.
        El buscador combina Big Data, Elasticsearch y MongoDB Atlas para entregarte
        resultados relevantes del marco regulatorio de MinMinas.
      </p>
      <ul class="mt-2">
        <li>B煤squeda por tema, entidad, a帽o o tipo de norma.</li>
        <li>Priorizaci贸n por relevancia (score Elasticsearch).</li>
        <li>Base lista para anal铆tica avanzada y modelos de recomendaci贸n.</li>
      </ul>
    </div>

    <div class="col-lg-6">
      <form
        class="d-flex flex-column flex-sm-row gap-2 mt-3 mt-lg-0"
        method="get"
        action="{{ url_for('buscador') }}"
      >
        <input
          type="text"
          class="form-control form-control-lg"
          name="q"
          placeholder="regal铆as, licencias ambientales, transici贸n energ茅tica..."
          value="{{ query or '' }}"
        />
        <button class="btn btn-primary btn-lg" type="submit">
           Buscar
        </button>
      </form>

      {% if query %}
      <p class="mt-3 text-muted">
        Resultados para: <strong>"{{ query }}"</strong>
        {% if total is not none %} 路 {{ total }} documento(s){% endif %}
      </p>
      {% endif %}

      {% if error_msg %}
      <div class="alert alert-danger mt-3">
        {{ error_msg }}
      </div>
      {% endif %}
    </div>
  </section>

  {% if resultados %}
  <section class="mt-4">
    <div class="result-grid">
      {% for r in resultados %}
      <article class="result-card">
        <h2 class="h5 mb-2">
          {{ r.titulo or "Sin t铆tulo" }}
        </h2>

        <dl class="result-meta">
          <div>
            <dt>Entidad</dt>
            <dd>{{ r.entidad or "N/D" }}</dd>
          </div>
          <div>
            <dt>A帽o</dt>
            <dd>{{ r.anio or "N/D" }}</dd>
          </div>
          <div>
            <dt>Tipo</dt>
            <dd>{{ r.tipo or "N/D" }}</dd>
          </div>
          <div>
            <dt>score</dt>
            <dd>{{ "%.2f"|format(r.score or 0) }}</dd>
          </div>
        </dl>
      </article>
      {% endfor %}
    </div>
  </section>
  {% elif query and not error_msg %}
  <p class="mt-4 text-muted">No se encontraron normas para esa consulta.</p>
  {% endif %}

  <p class="text-muted mt-5 small">
    Desarrollado por Juan Sebasti谩n Mora Zapata 路 Proyecto BigData 2025
  </p>
</main>
{% endblock %}
