{% extends "base.html" %}

{% block title %}Buscador · MinMinas{% endblock %}

{% block content %}
<div class="py-4">
  <h1 class="display-6 fw-semibold text-center mb-2">
    Buscador de normas y documentos
  </h1>
  <p class="text-center text-muted mb-4">
    Consulta la normatividad y documentos técnicos indexados en Elasticsearch
    para el Ministerio de Minas y Energía.
  </p>

  <!-- Formulario de búsqueda (sin JavaScript, todo por servidor) -->
  <form method="get" action="{{ url_for('buscador') }}" class="row justify-content-center mb-4">
    <div class="col-12 col-md-8 col-lg-6">
      <div class="input-group input-group-lg shadow-sm">
        <input
          type="text"
          name="q"
          class="form-control"
          placeholder="Ej: minería, transición energética, resolución 123..."
          value="{{ q or '' }}"
          required
        >
        <button class="btn btn-primary" type="submit">Buscar</button>
      </div>
    </div>
  </form>

  {% if error %}
    <div class="alert alert-danger text-center">
      {{ error }}
    </div>
  {% endif %}

  {% if q and not error and total == 0 %}
    <div class="alert alert-warning text-center">
      No se encontraron resultados para <strong>{{ q }}</strong>.
    </div>
  {% endif %}

  {% if results %}
    <p class="text-muted mb-2">
      {{ total }} resultado{{ 's' if total != 1 else '' }} encontrado{{ 's' if total != 1 else '' }}.
    </p>

    <div class="list-group shadow-sm">
      {% for doc in results %}
        <a href="{{ doc.enlace or '#' }}"
           target="_blank"
           class="list-group-item list-group-item-action">
          <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{ doc.titulo or 'Documento sin título' }}</h5>
            {% if doc.fecha %}
              <small class="text-muted">{{ doc.fecha }}</small>
            {% endif %}
          </div>
          {% if doc.resumen %}
            <p class="mb-1 text-muted small">{{ doc.resumen }}</p>
          {% endif %}
          {% if doc.entidad %}
            <small class="badge text-bg-light">{{ doc.entidad }}</small>
          {% endif %}
        </a>
      {% endfor %}
    </div>
  {% endif %}
</div>
{% endblock %}
